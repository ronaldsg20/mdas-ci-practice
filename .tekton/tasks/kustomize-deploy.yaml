apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: kustomize-deploy
  namespace: rylangraham02-dev
spec:
  params:
    - name: environment
      type: string
      description: Target environment (dev, staging, prod)
    - name: namespace
      type: string
      description: Target namespace

  workspaces:
    - name: source

  steps:
    - name: deploy
      image: quay.io/openshift/origin-cli:latest
      workingDir: $(workspaces.source.path)
      script: |
        #!/bin/bash
        set -e
        
        echo "Deploying to environment: $(params.environment)"
        echo "Target namespace: $(params.namespace)"
        
        # Apply Kustomize configuration
        oc apply -k k8s/overlays/$(params.environment) -n $(params.namespace)
        
        echo "Deployment applied successfully"
